<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebSocket μ±„ν… ν…μ¤νΈ</title>
</head>
<body>
  <h2>π” WebSocket μ±„ν… ν…μ¤νΈ</h2>

  <label>JWT Token: </label><br>
  <input id="token" type="text" size="80" placeholder="Bearer μ μ™Έν• μμ JWT μ…λ ¥"><br><br>

  <label>Chat Index: </label><br>
  <input id="chatIndex" type="number" value="1"><br><br>

  <label>User Index: </label><br>
  <input id="userIndex" type="number" value="1"><br><br>

  <label>Message Content: </label><br>
  <input id="content" type="text" size="50"><br><br>

  <button onclick="connect()">Connect</button>
  <button onclick="sendMessage()">Send</button>

  <h3>π“¥ μμ‹  λ©”μ‹μ§€:</h3>
  <pre id="messages" style="background:#f0f0f0; padding:10px; height:300px; overflow:auto;"></pre>

  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

  <script>
    let stompClient = null;

    function connect() {
      const token = document.getElementById('token').value;
      const socket = new SockJS("http://localhost:8080/ws-chat");
      stompClient = Stomp.over(socket);
      stompClient.connect(
        { Authorization: "Bearer " + token },
        function (frame) {
          log("β… μ—°κ²° μ„±κ³µ: " + frame);
          stompClient.subscribe("/topic/chat", function (message) {
            log("π“© μμ‹ λ¨: " + message.body);
          });
        },
        function (error) {
          log("β μ—°κ²° μ‹¤ν¨: " + error);
        }
      );
    }

    function sendMessage() {
      const chatIndex = document.getElementById('chatIndex').value;
      const userIndex = document.getElementById('userIndex').value;
      const content = document.getElementById('content').value;

      stompClient.send("/app/chat.sendMessage", {}, JSON.stringify({
        chatIndex: Number(chatIndex),
        userIndex: Number(userIndex),
        content: content,
        messageType: "TEXT"
      }));
      log("π€ μ „μ†΅λ¨: " + content);
    }

    function log(message) {
      const messagesEl = document.getElementById('messages');
      messagesEl.textContent += message + "\n";
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
  </script>
</body>
</html>
